---
import BaseLayout from '../layouts/BaseLayout.astro';
import CameraFeed from '../components/CameraFeed.astro';
import GameSettings from '../components/GameSettings.astro';
import TestCompleteScreen from '../components/TestCompleteScreen.astro';
import TestStartScreen  from '../components/TestStartScreen.astro';
import GameHeaderBar from  '../components/GameHeaderBar.astro';
import '../css/game.css';
---

<BaseLayout selectedPage="game">
    
    <div id="game-container">
        <!-- Game Header Bar -->
        <GameHeaderBar />
        
        <!-- Game Main Area -->
        <div class="game-main">
            <!-- Camera feed overlay (small, inside game) -->
            <div class="camera-overlay">
                <button id="gameLandmarkToggle" class="game-landmark-toggle" title="Toggle hand landmarks" style="display: none;">üìç</button>
                <CameraFeed videoId="video" />
                <div class="current-note" id="currentGesture">-</div>
            </div>
            
            <!-- Now Playing indicator -->
            <div class="now-playing">
                <div class="now-label">NOW:</div>
                <div class="now-note" id="targetGesture">-</div>
            </div>
            
            <!-- Game canvas -->
            <canvas id="gameCanvas"></canvas>
            
            <!-- Game over screen, go when someone runs out of lives -->
            <div id="gameOverBackdrop" class="modal-backdrop hidden">
                <div id="gameOverScreen" class="game-over">
                    <h2>Game Over!</h2>
                    <p class="final-score">Score: <span id="finalScore">0</span></p>
                    <p class="final-combo">Max Combo: <span id="finalCombo">0</span></p>
                    <button id="restartBtn" class="game-btn">Play Again</button>
                </div>
            </div>
            
            <!-- this is only relevant for flute tests, where it's possible to actually finish a test -->
            <TestCompleteScreen />
            
            <!-- Start screen -->
            <TestStartScreen />
        </div>
    </div>
    
    <!-- Game Settings Modal -->
    <GameSettings />
    
    <!-- Reuse existing camera/API infrastructure -->
    <script src="../js/camera.js"></script>
    
    <!-- Load in dependency order (bc modules depend on each other) -->
    
    <!-- Config layer -->
    <script src="../js/game/config/GameConstants.js"></script>
    <script src="../js/game/config/GameSettings.js"></script>
    
    <!-- Assets & Tests -->
    <script src="../js/game/assets/ImageManager.js"></script>
    <script src="../js/game/music/MusicalTest.js"></script>
    
    <!-- Entities -->
    <script src="../js/game/entities/Player.js"></script>
    <script src="../js/game/entities/Obstacle.js"></script>
    
    <!-- Systems -->
    <script src="../js/game/systems/CollisionSystem.js"></script>
    <script src="../js/game/systems/RenderSystem.js"></script>
    
    <!-- Managers -->
    <script src="../js/game/managers/ScoreManager.js"></script>
    <script src="../js/game/managers/InputManager.js"></script>
    
    <!-- Core Engine -->
    <script src="../js/game/core/GameEngine.js"></script>
    
    <!-- UI Layer -->
    <script src="../js/game/ui/GameController.js"></script>
</BaseLayout>
