---
import BaseLayout from '../layouts/baseLayout.astro';
import CameraToggleButton from '../components/CameraToggleButton.astro';
import CameraFeed from '../components/CameraFeed.astro';

import '../css/game.css';
---

<BaseLayout>
<header>
        <h1>ðŸŽµ FluteVision</h1>
        <p class="subtitle">Game Mode</p>
        <button id="navToggle" class="nav-toggle">Menu</button>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="practice.html">Practice</a>
            <a href="game.html" class="active">Game</a>
        </div>
    </header>
    
    <CameraToggleButton />
    
    <div id="game-container">
        <div class="game-wrapper">
            <!-- Camera feed -->
            <div class="camera-panel">
                <CameraFeed videoId="video" />
                <div class="prediction-display">
                    <div class="current-gesture" id="currentGesture">-</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="confidenceFill"></div>
                    </div>
                </div>
            </div>
            
            <!-- Game canvas -->
            <div class="game-panel">
                <canvas id="gameCanvas"></canvas>
                
                <!-- Game UI overlay -->
                <div class="game-ui">
                    <div class="target-gesture">
                        <span class="label">Play:</span>
                        <span class="gesture" id="targetGesture">-</span>
                    </div>
                    <div class="score-display">
                        <span class="label">Score:</span>
                        <span class="score" id="score">0</span>
                        <span class="combo" id="combo"></span>
                    </div>
                    <div class="high-score">
                        <span class="label">Best:</span>
                        <span class="score" id="highScore">0</span>
                    </div>
                </div>
                
                <!-- Game over screen -->
                <div id="gameOverScreen" class="game-over hidden">
                    <h2>Game Over!</h2>
                    <p class="final-score">Score: <span id="finalScore">0</span></p>
                    <p class="final-combo">Max Combo: <span id="finalCombo">0</span></p>
                    <button id="restartBtn" class="game-btn">Play Again</button>
                </div>
                
                <!-- Start screen -->
                <div id="startScreen" class="start-screen">
                    <h2>Ready to Play?</h2>
                    <p>watch the target gesture and play it to make your character jump!</p>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                        <strong>Testing:</strong> Press <kbd style="background: #f3f4f6; padding: 2px 6px; border-radius: 3px; border: 1px solid #ccc;">Space</kbd> to jump
                    </p>
                    <div id="status" class="status">Initializing...</div>
                    <button id="startBtn" class="game-btn" disabled>Start Game</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Reuse existing camera/API infrastructure -->
    <script is:inline src="/src/js/api.js"></script>
    <script is:inline src="/src/js/camera.js"></script>
    <script is:inline src="/src/js/navigation.js"></script>
    
    <!-- Load in dependency order (bc modules depend on each other) -->
    
    <!-- Config layer -->
    <script is:inline src="/src/js/game/config/GameConstants.js"></script>
    <script is:inline src="/src/js/game/config/GameSettings.js"></script>
    
    <!-- Assets & Music -->
    <script is:inline src="/src/js/game/assets/AssetManager.js"></script>
    <script is:inline src="/src/js/game/music/MusicalTest.js"></script>
    <script is:inline src="/src/js/game/music/TestLibrary.js"></script>
    
    <!-- Entities -->
    <script is:inline src="/src/js/game/entities/Player.js"></script>
    <script is:inline src="/src/js/game/entities/Obstacle.js"></script>
    
    <!-- Systems -->
    <script is:inline src="/src/js/game/systems/CollisionSystem.js"></script>
    <script is:inline src="/src/js/game/systems/RenderSystem.js"></script>
    
    <!-- Managers -->
    <script is:inline src="/src/js/game/managers/ScoreManager.js"></script>
    <script is:inline src="/src/js/game/managers/InputManager.js"></script>
    
    <!-- Core Engine -->
    <script is:inline src="/src/js/game/core/GameEngine.js"></script>
    
    <!-- UI Layer -->
    <script is:inline src="/src/js/game/ui/SettingsUI.js"></script>
    <script is:inline src="/src/js/game/ui/GameController.js"></script>
</BaseLayout>
