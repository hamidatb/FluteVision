name: Deploy Frontend to Heroku

on:
  push:
    branches:
      - main
    paths:
      - 'frontend/**'
      - '.github/workflows/deploy-frontend.yml'
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: frontend   

    env:
      HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
      HEROKU_APP_NAME: ${{ secrets.HEROKU_FRONTEND_APP_NAME }}
      FRONTEND_URL: ${{ secrets.HEROKU_FRONTEND_URL }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Deploy frontend to Heroku
        run: |
          # configure git for Heroku
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "GitHub Actions"

          # add Heroku remote
          git remote add heroku-frontend https://heroku:$HEROKU_API_KEY@git.heroku.com/$HEROKU_APP_NAME.git || true

          # push frontend subtree to Heroku
          git push heroku-frontend `git subtree split --prefix frontend main`:refs/heads/main --force

      - name: Check deployment status
        run: |
          echo "âœ… Frontend deployed successfully to $FRONTEND_URL"
